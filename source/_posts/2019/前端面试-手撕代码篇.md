---
title: å‰ç«¯é¢è¯•-æ‰‹æ’•ä»£ç ç¯‡
date: 2019-12-04 10:07:39
tags: 'å‰ç«¯é¢è¯•'
categories: 'å‰ç«¯é¢è¯•'
copyright: true
---
# å‰è¨€
åœ¨å‰ç«¯é¢è¯•æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç¯èŠ‚ï¼Œä¹Ÿæ˜¯é¢è¯•è€…æœ€æ‹…å¿ƒçš„ä¸€ä¸ªç¯èŠ‚ã€‚å¯¹â€œæ‰‹æ’•ä»£ç â€çš„è€ƒå¯Ÿéœ€è¦é¢è¯•è€…å¹³æ—¶æ€»ç»“å’Œç§¯ç´¯ï¼ˆä¸´æ—¶æŠ±ä½›è„šæ˜¯ä¸å¥½ä½¿çš„ï¼‰ï¼Œåœ¨è¿™é‡Œç¬”è€…å°±è‡ªå·±å¦‚ä½•æ”»ç ´â€œæ‰‹æ’•ä»£ç â€ç¯èŠ‚æ€»ç»“äº†ä¸€äº›ç»éªŒï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ æŒ‘æˆ˜é«˜è–ªï¼Œè¿å¨¶ç™½å¯Œç¾ğŸ˜„ğŸ˜„ğŸ˜„ã€‚
1.  ä½¿ç”¨IDEæ—¶å°½é‡é¿å…ç›´æ¥ä½¿ç”¨æç¤ºAPIï¼Œäº²è‡ªè¾“å…¥ï¼ˆå­°èƒ½ç”Ÿå·§ï¼Œå½“ç„¶æ„Ÿè§‰æ²¡é—®é¢˜çš„APIå°±ä¸ç”¨æµªè´¹æ—¶é—´äº†ï¼‰
2.  é‡åˆ°ä¸ç†Ÿæ‚‰çš„APIï¼Œä¸€å®šè¦æŸ¥æ–‡æ¡£ç ”ç©¶æ¸…æ¥šï¼ˆå‚æ•°ä¸ªæ•°å’Œå…·ä½“æ„ä¹‰ä»¥åŠè¿”å›å€¼ï¼‰
3.  å¦‚åœ¨æ¨¡æ‹ŸæŸä¸ªåŸç”ŸAPIæ—¶ï¼Œå…ˆå†™å‡ºåŸç”ŸAPIå¹¶åˆ†æå‡ºå½¢å‚å’Œè¿”å›å€¼
4.  æ„Ÿè§‰åŠŸèƒ½å®Œæˆæ—¶ï¼Œéœ€è¦åœ¨è€ƒè™‘ä¸€ä¸‹è¾¹ç•Œæ¡ä»¶ï¼ˆå‚æ•°éæ¯”å¡«æƒ…å†µã€undefinedã€nullï¼‰
5.  å¹³å¸¸æœ‰ç©ºæ—¶å¤šåˆ·åˆ·ä¸€äºŒçº¿å¤§å‚çš„é¢è¯•é¢˜ï¼ˆæ‰©å……è‡ªå·±çš„çŸ¥è¯†å¹¿åº¦ï¼‰
6.  å¤šå…³ç…§ä¸€äº›å‰ç«¯åŠ¨æ€ï¼ˆæ¯”å¦‚è¯´curryã€composeä½ æ²¡å¬è¿‡ï¼Œè¿™å°±æœ‰ç‚¹å°´å°¬ï¼‰

# å¸¸è§çš„â€œæ‰‹æ’•ä»£ç â€ï¼Œéƒ½æ˜¯é«˜é¢‘é¢˜å“¦
##  curryï¼ˆæŸ¯é‡ŒåŒ–ï¼‰
```
function curry(fn: any) {
  return function judgeCurry(...args: any) {
      return fn.length > args.length ? 
          (...args1: any) => judgeCurry(...args,...args1):
          fn(...args);
  }
}
```
##  composeï¼ˆå‡½æ•°ç»„åˆï¼‰
```
function compose(...args: any[]) {
  return (subArgs: any) => {
    // for(let i = args.length - 1; i >= 0; i--) {
    //   res = args[i](res);
    // }
    return args.reverse().reduce((acc, func,index) => {
      return func(acc);
    }, subArgs);
  }
}
```
##  pipeï¼ˆå‡½æ•°ç®¡é“ï¼‰
```
export function pipe(...args: any[]) {
  return (subArgs: any) => {
    // for(let i = args.length - 1; i >= 0; i--) {
    //   res = args[i](res);
    // }
    return args.reduce((acc, func,index) => {
      return func(acc);
    }, subArgs);
  }
}
```
##  throttleï¼ˆå‡½æ•°èŠ‚æµï¼‰
```
function throttle(fn: any, wait: number){
  let last: any;
  return function() {
    let now: any = Date.now();
    // åˆæ¬¡æ‰§è¡Œ
    if (!last) {
      fn.apply(this, arguments);
      last = now;
      return;
    }
    // ä»¥åè§¦å‘ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦åˆ°å»¶è¿Ÿ
    if(now - last >= wait) {
      fn.apply(this, arguments);
      last = now;
    }
  }
}
```
##  debounceï¼ˆå‡½æ•°é˜²æŠ–ï¼‰
```
function debounce(func: any, delay: number) {              
    // åˆæ¬¡è§¦å‘å®šæ—¶å™¨ä¸ºnullï¼Œåé¢äº§ç”Ÿä¸€ä»½å®šæ—¶å™¨å¹¶è®°ä¸‹å®šæ—¶å™¨id
    let timer: any = null; 
    // é—­åŒ…ä½¿å®šæ—¶å™¨idé€ƒé€¸   
    return function() {                             
        let args = arguments;  
        // å¦‚æœå·²æœ‰å®šæ—¶å™¨idï¼Œåˆ™éœ€è¦æ¸…é™¤ï¼Œé‡æ–°å¼€å§‹å»¶è¿Ÿæ‰§è¡Œ           
        if (timer) {
            clearTimeout(timer);
            timer = null;                                   
        }
        
        timer = setTimeout( () => { 
            func.apply(this, args); 
            // é”€æ¯å®šæ—¶å™¨idï¼Œä»¥ä¾¿ä¸‹æ¬¡èŠ‚æµå‡½æ•°è§¦å‘                       
            timer = null;                    
        }, delay); 
    }        
}
```
##  formatMoneyï¼ˆåƒåˆ†ä½ï¼‰
```
function fmoney(num: number){
    /* æ­£åˆ™å®ç° */
    // å‚è€ƒï¼šhttps://www.cnblogs.com/lvmylife/p/8287247.html
    let [integer, decimal] = String(num).split('.');
    let regExp = /\d{1,3}(?=(\d{3})+$)/g;
    integer = integer.replace(regExp, '$&,');
    return `${integer}${decimal === undefined ? '': '.'+decimal}`;
    // æ­£åˆ™è§£é‡Š
    // æ­£åˆ™è¡¨è¾¾å¼ \d{1,3}(?=(\d{3})+$)  è¡¨ç¤ºå‰é¢æœ‰1~3ä¸ªæ•°å­—ï¼Œåé¢çš„è‡³å°‘ç”±ä¸€ç»„3ä¸ªæ•°å­—ç»“å°¾
    // å…ˆè¡Œè‚¯å®šæ–­è¨€(?=)ä¼šä½œä¸ºåŒ¹é…æ ¡éªŒï¼Œä½†ä¸ä¼šå‡ºç°åœ¨åŒ¹é…ç»“æœå­—ç¬¦ä¸²é‡Œé¢
    // ?=è¡¨ç¤ºæ­£å‘å¼•ç”¨ï¼Œå¯ä»¥ä½œä¸ºåŒ¹é…çš„æ¡ä»¶ï¼Œä½†åŒ¹é…åˆ°çš„å†…å®¹ä¸è·å–ï¼Œå¹¶ä¸”ä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„å¼€å§‹
    // $& è¡¨ç¤ºä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å†…å®¹ï¼Œå…·ä½“çš„å¯æŸ¥çœ‹ w3schoolçš„replace()æ–¹æ³•

    /* Number.prototype.toLocaleString()å®ç° */
    // Number.prototype.toLocaleString()
    // return num.toLocaleString('en');

    /* Intl.NumberFormat().format(number)å®ç° */
    // Intl.NumberFormat().format(number)
    // return Intl.NumberFormat('en').format(num);

    // reduce æ–¹æ¡ˆ
    // let arr = String(num).split('.');
    // let char = arr[0].split('').reverse();   
    // let IntStr = char.reduce((acc, value, index) => {
    //     return `${index % 3 === 0 ? String(value)+',' : String(value)}${acc}`;
    // }, '').slice(0, -1);
    // return `${IntStr}${arr[1]? '.'+arr[1] : '' }`;
}
```
##  deepCloneï¼ˆæ·±æ‹·è´ï¼‰
è¯´æ˜ï¼šé€šè¿‡new WeakMap()æ¥é¿å…å¾ªç¯å¼•ç”¨ï¼ˆæ‹·è´å¼•ç”¨ç±»å‹æ—¶å¹¶ä¿å­˜å…¶åœ°å€ï¼Œåé¢é‡åˆ°å¼•ç”¨ç±»å‹å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»ä¿å­˜äº†ï¼‰<br>
é€šè¿‡Reflect.ownKeys(obj)éå†å‡ºobjè‡ªèº«çš„æ‰€æœ‰å¯æšä¸¾å’Œä¸å¯æšä¸¾çš„å±æ€§ä»¥åŠsymbolå±æ€§<br>
æ‹·è´å¯¹åº”å±æ€§çš„å±æ€§æè¿°ç¬¦
```
function checkType(obj: any): string {

  const type = Object.prototype.toString.call(obj);
  return type.slice(8, -1);
}

// æ·±æ‹·è´ï¼ˆhash = new WeakMap()è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
export function deepClone(obj: any, hash = new WeakMap()) : any{
  if(checkType(obj) === 'RegExp') {
    // regExp.source æ­£åˆ™å¯¹è±¡çš„æºæ¨¡å¼æ–‡æœ¬;
    // regExp.flags æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ ‡å¿—å­—ç¬¦ä¸²;
    // regExp.lastIndex ä¸‹æ¬¡åŒ¹é…å¼€å§‹çš„å­—ç¬¦ä¸²ç´¢å¼•ä½ç½®
    let temp =  new RegExp(obj.source, obj.flags);
    temp.lastIndex = obj.lastIndex;
    return temp;
  }
  if(checkType(obj) === 'Date') {
      return new Date(obj);
  }
  // éå¤æ‚ç±»å‹(nullã€undefinedã€stringã€numberã€symbolã€booleanã€function)
  if(obj === null || typeof obj !== 'object') {
      return obj;
  }
  // è¿˜å¯ä»¥æ‰©å±•å…¶ä»–ç±»å‹ã€‚ã€‚ã€‚
  // ä¸åé¢hash.set()é˜²æ­¢å¾ªç¯å¼•ç”¨
  if(hash.has(obj)) {
      return hash.get(obj);
  }

  let newObj = new obj.constructor();
  hash.set(obj, newObj);
  // Object.keys(obj)ç±»å‹äº for in å’Œ obj.hasOwnProperty
  // æ˜¯å¦åº”è¯¥æ‹·è´è‡ªèº«å±æ€§ï¼ˆå¯æšä¸¾çš„å’Œä¸å¯æšä¸¾çš„ä»¥åŠsymbolï¼‰
  Reflect.ownKeys(obj).forEach(function(key) {
      if(typeof obj[key] === 'object' && obj[key] !== null) {
          newObj[key] = deepClone(obj[key], hash);
      }else{
          // ç›´æ¥èµ‹å€¼
          // newObj[key] = obj[key];
          // æ˜¯å¦åº”è¯¥ä¿ç•™å±æ€§æè¿°ç¬¦
          Object.defineProperty(newObj, key, Object.getOwnPropertyDescriptor(obj, key));
      }
  });

  return newObj;
}
```
##  æ¨¡æ‹Ÿinstanceof
```
function instance_of(L: Object, R: any){
  let protoChain = Object.getPrototypeOf(L);
  const Lprototype = R.prototype;
  // æœ€åæƒ…å†µé€’å½’æŸ¥åˆ°Object.prototype === null
  while(protoChain) {
      // ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåˆ™ä¸ºåŒä¸€ä¸ªå¯¹è±¡
      if(protoChain === Lprototype) {
        return true;
      }
      protoChain = Object.getPrototypeOf(protoChain);
  }
  // æ‰¾åˆ°ç»ˆç‚¹è¿˜æ²¡æ‰¾åˆ°ï¼Œé‚£å°±æ²¡æœ‰äº†å‘—
  return false;
}
```
##  å®ç°callæ–¹æ³•
```
Function.prototype.myCall = function myCall() {
  let [thisArg, ...args] = Array.from(arguments);
  if (!thisArg) {
      //context ä¸º null æˆ–è€…æ˜¯ undefined
      thisArg = typeof window === 'undefined' ? global : window;
  }
  // this çš„æŒ‡å‘çš„æ˜¯å½“å‰å‡½æ•° func (func.call)
  // ä¸ºthisArgå¯¹è±¡æ·»åŠ funcæ–¹æ³•ï¼Œfuncæ–¹æ³•åˆæŒ‡å‘myCallï¼Œæ‰€ä»¥åœ¨funcä¸­thisæŒ‡å‘thisArg
  thisArg.func = this;
  // æ‰§è¡Œå‡½æ•°
  let result = thisArg.func(...args);
  // thisArg ä¸Šå¹¶æ²¡æœ‰ func å±æ€§ï¼Œå› æ­¤éœ€è¦ç§»é™¤
  delete thisArg.func; 
  return result;
}
```
##  å®ç°applyæ–¹æ³•
```
Function.prototype.myApply = function myApply() {
  // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºthiså¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼ˆä¸myCallå”¯ä¸€çš„åŒºåˆ«å°±åœ¨ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„ï¼‰
  let [thisArg, args] = Array.from(arguments);
  if (!thisArg) {
      //context ä¸º null æˆ–è€…æ˜¯ undefined
      thisArg = typeof window === 'undefined' ? global : window;
  }
  // this çš„æŒ‡å‘çš„æ˜¯å½“å‰å‡½æ•° func (func.call)
  thisArg.func = this;
  // æ‰§è¡Œå‡½æ•°
  let result = thisArg.func(...args);
  // thisArg ä¸Šå¹¶æ²¡æœ‰ func å±æ€§ï¼Œå› æ­¤éœ€è¦ç§»é™¤
  delete thisArg.func; 
  return result;
}
```
##  å®ç°bindæ–¹æ³•
```
Function.prototype.myBind = function myBind() {
  let [thisArg, ...args] = [...arguments];
  if (!thisArg) {
      //context ä¸º null æˆ–è€…æ˜¯ undefined
      thisArg = typeof window === 'undefined' ? global : window;
  }
  let that = this;

  return function() {
      // é˜²æ­¢ç¬¬äºŒæ¬¡è°ƒç”¨ func æ˜¯ï¼Œè¯¥funcå·²ç»è¢«deleteäº†ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ 
      if(!thisArg.func) {
        thisArg.func = that;
      }
      let result = thisArg.func(...args);
      // thisArgåŸæœ¬æ²¡æœ‰funcæ–¹æ³•
      delete thisArg.func;
      return result;
  }
}
```
##  æ¨¡æ‹ŸPromise.allï¼ˆå¤šä¸ªPromiseå¹¶è¡Œæ‰§è¡Œï¼‰
ç›®å‰è¿˜å­˜åœ¨å‚æ•°é€‚é…çš„é—®é¢˜
```
var p1 = function(){
  return new Promise((resolve, reject) => {setTimeout(function(){resolve('12')}, 1000)})
};
var p2 = function(){
  return new Promise((resolve, reject) => {setTimeout(function(){resolve(2)}, 2000)})
};
var p3 = function(){
  return new Promise((resolve, reject) => {setTimeout(function(){resolve(3)}, 1000)})
};
function promiseAll(tasks) {
  let ary = new Array(tasks.length).fill(1).map(item => {return {val: undefined, success: false}});
  return new Promise((resolve, reject) => {
    for(let i = 0; i < tasks.length; i++) {
      tasks[i]().then(res => {
        ary[i].val = res;
        ary[i].success = true;
        if(ary.every(item => item.success === true)){
          resolve(ary.map(item => item.val))
        }
      }).catch(err => {
        reject(err);
      });
    }
  });
}
// test
promiseAll([p1, p2, p3]).then(res => console.log(res)).catch(err => {
  console.log(err);
});
```
##  å¤šä¸ªPromiseä¸²è¡Œæ‰§è¡Œ(ä¸¤ç§æ–¹å¼)
```
function parallelPromises1(tasks){
  var result = [];
  return tasks.reduce((accumulator,item,index)=>{
    return accumulator.then(res=>{
        item = typeof item === 'function' ? item() : item;
        return item.then(res=>{
          // debugger
              result[index] = res
              return index == tasks.length - 1 ? result : item
        })
    })
  },Promise.resolve())
}

async function parallelPromises2(tasks) {
  let ary = [];
  for (let task of tasks) {
    let temp = await task();
    ary.push(temp);
  }
  return ary;
}
```
# å†™åœ¨åé¢
ä¸Šé¢ä»£ç å®Œå…¨æ˜¯ç¬”è€…æ‰‹æ•²ï¼Œéš¾å…æœ‰é”™è¯¯ï¼Œè¿˜æœ›æ–§æ­£ã€‚è¿™ç§é¢˜ç›®è¿˜æœ‰å¾ˆå¤šï¼ˆå®ç°ç®€æ˜“ç‰ˆçš„EventEmitterã€ç®€æ˜“ç‰ˆæ¨¡ç‰ˆå¼•æ“ç­‰ï¼‰ï¼Œç¬”è€…ä¼šæŒç»­æ›´æ–°ã€‚å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¿ºå¸Œæœ›é€ä¸Šä½ çš„[githubå°æ˜Ÿæ˜Ÿ](https://github.com/fanerge/WEB-repo)ï¼Œåœ¨æ­¤æ„Ÿè°¢ã€‚<br>
æœ¬æ–‡åŒæ­¥å‘å¸ƒäº[ä¸ªäººåšå®¢](https://fanerge.github.io/2019/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-%E6%89%8B%E6%92%95%E4%BB%A3%E7%A0%81%E7%AF%87.html)[æ˜é‡‘](https://juejin.im/user/57cede6d5bbb50005b97536a)[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/95165262)<br>



